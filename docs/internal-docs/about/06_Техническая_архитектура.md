# Техническая архитектура

Interactive Classroom Platform разработана как многоуровневое веб-приложение, состоящее из следующих основных компонентов:

- Клиентская часть (Front-end): реализована в виде одностраничного веб-приложения (SPA) либо набора взаимосвязанных страниц. Она отвечает за отображение интерфейсов для трех ролей (преподаватель, студент, проектор). Для динамичного обновления интерфейса используются современные веб-технологии (JavaScript/TypeScript-фреймворки). Главные требования: адаптивность под мобильные устройства и поддержка реального времени. При подключении к сессии клиентское приложение устанавливает постоянное соединение с сервером (например, через WebSocket) для получения обновлений без перезагрузки.
    
- Серверная часть (Back-end): отвечает за бизнес-логику приложения, обработку событий и обмен данными между клиентами. Это веб-сервер, работающий постоянно и обрабатывающий многочисленные соединения. Основные задачи сервера:
    
- Управление сессиями: сервер хранит информацию о запущенных сессиях (идентификатор, настройки, активный режим), отслеживает подключение и отключение участников. Когда преподаватель создает новую сессию, генерируется уникальный ID и QR-код; когда студент подключается, сервер регистрирует его в списке участников.
    
- Реализация интерактивной логики: сервер принимает сообщения от клиентов (вопрос от студента, ответ в викторине, сообщение чата, реакция) и распределяет их соответствующим получателям. Например, студент отправил вопрос – сервер сохраняет его и рассылает преподавателю и на проектор (при отключенной модерации – сразу всем), а другим студентам может разослать только после одобрения вопроса преподавателем. Для мгновенной рассылки используется механизм публикации/подписки: участники сессии подписаны на обновления своей комнаты, и сервер делает broadcast сообщения всем подписчикам комнаты.
    
- Модерация и фильтрация: сервер содержит правила, согласно которым определенные сообщения не транслируются сразу. Если включен фильтр, то вопросы помечаются как “pending” и не отправляются на проектор, пока преподаватель через админ-панель не разрешит. Также, сервер может автоматически отсеивать запрещенные слова, спам (например, дубликаты, слишком частые сообщения от одного пользователя) и не пропускать их дальше.
    
- Подсчет и агрегирование: сервер выполняет подсчет лайков (например, увеличивает счетчик у вопроса и пересылает обновленное значение всем клиентам), собирает результаты викторины (суммирует ответы, определяет процент по вариантам, вычисляет кто выиграл), отслеживает активность для рейтинга. Эта обработка происходит либо в памяти сервера, либо с помощью запросов к базе данных.
    
- API и интеграции: сервер предоставляет API для внешних сервисов. Например, Telegram-бот через токен может вызвать метод сервера для получения текущего QR-кода сессии и информации о ней. Также, модуль перевода: при запросе перевода от клиента сервер обращается к стороннему API машинного перевода (или локальной ML-модели), получает перевод и отдает его пользователю. Эти внешние вызовы изолированы и защищены (например, с ограничением частоты, чтобы не перегружать сервис перевода).
    
- Аутентификация: при использовании неанонимного режима сервер проверяет учетные данные студентов. Это может быть интеграция с университетской SSO-системой (OAuth/OpenID Connect) или собственная система регистрации/логина. В случае SSO пользователь при входе перенаправляется на страницу университета, а сервер получает подтверждение личности (например, электронную почту студента). Все обмены проходят по HTTPS, чтобы креденшлы были защищены.
    
- База данных: централизованное хранилище для всех постоянных данных. Выбор типа БД определяется масштабом и структурой данных (реляционная SQL или документно-ориентированная NoSQL). В базе данных хранятся:
    
- Учетные записи пользователей: информация о преподавателях (аккаунты с правами создания сессий) и при необходимости студентов (если требуется привязка к реальным личностям; для анонимного режима студенты могут не иметь записей или регистрироваться как гости).
    
- Сессии: таблица (или коллекция) с записями о проведенных сессиях – время, тема, кто вел, настройки (анонимность, включенные модули), а также ссылка на связанный контент (например, ID презентации, если загружена).
    
- Вопросы и ответы: все вопросы, присланные студентами, со ссылкой на сессию, временем отправки, автором (если не аноним) и счетчиком лайков. Аналогично, ответы студентов (в Q&A или викторине) могут сохраняться, если нужно пост-аналитика.
    
- Опросы/Викторины: список опросов в рамках сессии, варианты ответов, отметка правильного ответа (для викторин), результаты (сколько выбрало каждый вариант, кто ответил правильно/неправильно).
    
- Сообщения чата: могут сохраняться для протокола, особенно если нужны для разбора инцидентов или последующего анализа. Можно ограничивать хранение, например, до 7 дней, чтобы не накапливать лишнего.
    
- Шаблоны и настройки: сохраненные шаблоны интерактивов по пользователям-преподавателям. Также глобальные настройки (список запрещенных слов для фильтра, параметры системы).
    
- База данных взаимодействует с сервером через ORM или прямые запросы. При большой нагрузке критичные данные (например, лайки или счетчики ответов) могут храниться в памяти (кешироваться) и периодически сбрасываться в БД, чтобы сократить обращения.
    
- Реализация реального времени: как отмечалось, связь в режиме live организована через WebSocket-соединения. Каждый подключенный клиент держит открытое соединение, через которое сервер может мгновенно отправлять данные. Используется модель publish-subscribe: при входе в сессию сокет клиента подписывается на определенную "комнату" (channel) этой сессии. Сервер, получив новое событие (вопрос, сообщение, результат викторины), публикует его в нужную комнату, и все подписчики (включая проектор, преподавателя и студентов) получают уведомление. Это позволяет масштабировать систему: можно поднять несколько серверов и использовать брокер сообщений (например, Redis Pub/Sub) между ними для синхронизации, так что независимо от того, на каком узле находится подключение того или иного пользователя, он получит событие. При очень больших нагрузках может применяться горизонтальное масштабирование: несколько инстансов серверного приложения за балансировщиком, плюс отдельный сервис для WebSocket (например, специализированный менеджер соединений).
    
- Информационная безопасность: Поскольку система используется в образовательной среде, важно защитить данные: все соединения идут по HTTPS/WSS, чтобы исключить перехват трафика (особенно важных в случае авторизации). Вопросы и ответы могут содержать личные мнения студентов, поэтому доступ к административным данным ограничен только ведущим сессии. Сервер реализует и механизмы защиты от злоупотреблений: ограничивает количество запросов от одного IP (rate limiting) при подозрительной активности, чтобы предотвратить DDoS или флуд с одного устройства.
    
- Поддержка медиа и файлов: Если студенты присылают изображения (например, сфотографированный вопрос к преподавателю) или преподаватель демонстрирует изображения через платформу, сервер должен обеспечивать хранение и доставку этих файлов. Возможно использование облачных хранилищ (S3-совместимых) для файлов, с генерацией временных ссылок. В MVP же можно ограничиться текстовыми вопросами и реакциями. Презентации, загруженные преподавателем, хранятся на сервере и транслируются как набор изображений или PDF-страниц.
    
- Telegram-бот: Бот для Telegram реализуется отдельно, но тесно связан с сервером. Он работает через Telegram Bot API, получая команды от пользователя-преподавателя. Например, когда бот в чате курса получает команду /startquiz, он обращается к API нашего сервера, который проверяет права (является ли отправитель этой команды преподавателем соответствующего курса и есть ли у него активная сессия), затем выполняет действие – например, запускает викторину или возвращает боту ответ, что сейчас нет активной сессии. В MVP бот будет использоваться для рассылки ссылки на сессию: преподаватель вводит /startsession, бот запрашивает у сервера актуальный QR-код или ссылку и отправляет в чат. Такая интеграция снижает барьеры входа для студентов (ссылка у них уже в телефоне) и позволяет охватить аудиторию, не присутствующую физически (например, кто-то смотрит трансляцию лекции из дома и может вступить через ту же ссылку).
    
- Развертывание и масштабируемость: Приложение разворачивается на веб-сервере. Возможен сценарий деплоя на облачной платформе (AWS, Heroku, Яндекс Облако и т.п.) с автомасштабированием в часы пик. Компоненты (сервер, БД, бот) могут быть упакованы в контейнеры Docker для удобства управления. Важно предусмотреть резервное копирование данных БД (например, ежедневные бэкапы вопросов и статистики). В перспективе, если платформа будет использоваться массово (всем университетом), стоит рассмотреть микросервисную архитектуру, но на первом этапе монолитное приложение упростит разработку и поддержку.

Таким образом, архитектура обеспечивает модульность (разделение на фронтэнд, бэкэнд, базу), интерактивность (обмен событиями в реальном времени) и интеграцию с внешними сервисами. Все компоненты взаимодействуют по четко определенным интерфейсам – будь то HTTP API, WebSocket протокол или вызовы к базе данных. Это позволит в будущем развивать платформу – например, выпустить нативное мобильное приложение, используя тот же серверный API, или подключать новые модули (AI-ассистента для автоматического ответа на простые вопросы и пр.), не ломая существующую систему.